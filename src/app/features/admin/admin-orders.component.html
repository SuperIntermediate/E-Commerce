<section class="admin-orders">
  <header class="toolbar">
    <h2>Orders Management</h2>
    <div class="filters">
      <label>
        Status
        <select [ngModel]="filterStatus()" (ngModelChange)="filterStatus.set($event)" name="filter">
          <option value="ALL">All</option>
          <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
        </select>
      </label>
    </div>
  </header>

  @if (filtered().length > 0) {
    <table class="orders-table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Date</th>
          <th>Items</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (o of filtered(); track o.id) {
          <tr>
            <td>{{ o.id }}</td>
            <td>{{ o.date }}</td>
            <td>{{ o.items.length }}</td>
            <td>{{ o.total | currency }}</td>
            <td>
              <select [ngModel]="editedStatus()[o.id]" (ngModelChange)="setEdit(o.id, $event)" name="status-{{o.id}}">
                <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
              </select>
            </td>
            <td>
              <button class="primary" (click)="saveStatus(o.id)">Save</button>
              @if (o.status === 'PLACED') {
                <button class="danger" (click)="cancel(o.id)">Cancel</button>
              } @else {
                <span class="muted">—</span>
              }
            </td>
          </tr>
          <tr class="order-items">
            <td colspan="6">
              <ul>
                @for (item of o.items; track item.productId) {
                  <li>
                    {{ item.title }} × {{ item.quantity }} — {{ (item.price * item.quantity) | currency }}
                  </li>
                }
              </ul>
            </td>
          </tr>
        }
      </tbody>
    </table>
  } @else {
    <p class="empty">No orders found.</p>
  }
</section>