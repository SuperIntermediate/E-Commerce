import{a as V}from"./chunk-RUAZL4YI.js";import{a as D}from"./chunk-BGPM6P37.js";import{a as N,b as q,c as x,d as W,e as k,f as R,h as U,l as A,m as B}from"./chunk-MQBGRNKI.js";import{a as T}from"./chunk-YFYQOU26.js";import{a as I}from"./chunk-YQELJHLD.js";import{a as F}from"./chunk-B7GYXW7L.js";import{c as L,e as v,f as E}from"./chunk-SV7RER2E.js";import{Fa as h,Ra as M,Sa as y,T as g,Vb as S,Xa as f,Ya as o,Za as n,eb as P,gb as b,kb as r,lb as O,pb as c,qb as u,rb as C,sa as d,ub as w}from"./chunk-HE5TQUO2.js";var H=()=>["/signup"];function J(s,a){if(s&1&&(o(0,"p",10),r(1),n()),s&2){let l=b();d(),O(l.error)}}var j=class s{router=g(v);route=g(L);auth=g(T);products=g(D);cart=g(F);session=g(V);email="";password="";error="";roleTarget="customer";login(){this.error="";let a=this.route.snapshot.queryParamMap;try{if(this.auth.login({email:this.email.trim(),password:this.password}),a.get("action")==="add_to_cart"){let m=a.get("pid"),p=a.get("qty"),G=m?Number(m):NaN,z=p?Number(p):1,_=this.products.getById(G);_&&this.cart.add(I(_,Math.max(1,z)))}let e=a.get("redirectUrl"),i="/account";this.auth.isAdmin()?i="/admin":this.auth.isSeller()&&(i="/seller");let t=this.session.getLastUrl();this.router.navigateByUrl(e||t||i)}catch(l){let e=l?.message||"Login failed";if(this.error=e,e==="NO_ACCOUNT"){let i={email:this.email.trim(),redirectUrl:a.get("redirectUrl")||"/account"},t=a.get("action");t&&(i.action=t);let m=a.get("pid");m&&(i.pid=m);let p=a.get("qty");p&&(i.qty=p),this.router.navigate(["/signup"],{queryParams:i})}}}static \u0275fac=function(l){return new(l||s)};static \u0275cmp=h({type:s,selectors:[["app-login-page"]],decls:30,vars:8,consts:[[1,"auth-page"],[1,"toolbar"],[1,"link",3,"routerLink"],["novalidate","",1,"form"],[1,"role-switch"],["type","radio","name","role","value","customer",3,"ngModelChange","ngModel"],["type","radio","name","role","value","seller",3,"ngModelChange","ngModel"],["type","email","name","email","required","",3,"ngModelChange","ngModel"],["type","password","name","password","required","",3,"ngModelChange","ngModel"],[1,"submit",3,"click","disabled"],[1,"error"],[1,"oauth"],["disabled","",1,"google"]],template:function(l,e){l&1&&(o(0,"section",0)(1,"header",1)(2,"h1"),r(3,"Login"),n(),o(4,"a",2),r(5,"Create account"),n()(),o(6,"form",3)(7,"div",4)(8,"span"),r(9,"Login as"),n(),o(10,"label")(11,"input",5),C("ngModelChange",function(t){return u(e.roleTarget,t)||(e.roleTarget=t),t}),n(),r(12," Customer "),n(),o(13,"label")(14,"input",6),C("ngModelChange",function(t){return u(e.roleTarget,t)||(e.roleTarget=t),t}),n(),r(15," Seller "),n()(),o(16,"label"),r(17," Email "),o(18,"input",7),C("ngModelChange",function(t){return u(e.email,t)||(e.email=t),t}),n()(),o(19,"label"),r(20," Password "),o(21,"input",8),C("ngModelChange",function(t){return u(e.password,t)||(e.password=t),t}),n()(),o(22,"button",9),P("click",function(){return e.login()}),r(23,"Login"),n(),M(24,J,2,1,"p",10),n(),o(25,"div",11)(26,"p"),r(27,"Or continue with"),n(),o(28,"button",12),r(29,"Google (coming soon)"),n()()()),l&2&&(d(4),f("routerLink",w(7,H)),d(7),c("ngModel",e.roleTarget),d(3),c("ngModel",e.roleTarget),d(4),c("ngModel",e.email),d(3),c("ngModel",e.password),d(),f("disabled",!e.email||!e.password),d(2),y(e.error?24:-1))},dependencies:[S,B,R,N,U,q,x,A,k,W,E],styles:[".auth-page[_ngcontent-%COMP%]{padding:1rem}.auth-page[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.auth-page[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:grid;gap:.75rem;max-width:400px}.auth-page[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.auth-page[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid #ddd;border-radius:.5rem}.auth-page[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#1976d2;color:#fff;border:none;border-radius:4px;cursor:pointer}.auth-page[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.6}.auth-page[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:#d32f2f}.auth-page[_ngcontent-%COMP%]   .oauth[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;align-items:center}.auth-page[_ngcontent-%COMP%]   .oauth[_ngcontent-%COMP%]   .google[_ngcontent-%COMP%]{padding:.5rem .75rem;border:none;border-radius:4px;background:#4285f4;color:#fff}"]})};export{j as LoginPageComponent};
