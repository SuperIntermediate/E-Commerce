import{Fb as f,O as g,a as c,b as u,ea as m}from"./chunk-HE5TQUO2.js";function p(o){return o.map(r=>({productId:r.productId,title:r.title,price:r.price,imageUrl:r.imageUrl,category:r.category,quantity:r.quantity}))}var I="ng_ecommerce_orders_v1",l=class o{orders=m([]);constructor(){try{let r=localStorage.getItem(I);if(r){let t=JSON.parse(r);Array.isArray(t)&&this.orders.set(t)}}catch{}f(()=>{try{localStorage.setItem(I,JSON.stringify(this.orders()))}catch{}})}generateId(){return`ORD-${Date.now()}`}place(r,t,s){let e=p(t),n=e.reduce((i,a)=>i+a.price*a.quantity,0),d={id:this.generateId(),date:new Date().toISOString(),items:e,total:n,address:r,status:"PLACED",userId:s};return this.orders.set([d,...this.orders()]),d}cancel(r){let t=this.orders(),s=t.findIndex(i=>i.id===r);if(s<0)return;let e=t[s];if(e.status!=="PLACED")return e;let n=u(c({},e),{status:"CANCELLED"}),d=[...t];return d[s]=n,this.orders.set(d),n}getAll(){return this.orders()}getByUserId(r){return this.orders().filter(t=>t.userId===r)}getById(r){return this.orders().find(t=>t.id===r)}updateStatus(r,t){let s=this.orders(),e=s.findIndex(a=>a.id===r);if(e<0)return;let n=s[e];if(n.status==="CANCELLED")return n;let d=u(c({},n),{status:t}),i=[...s];return i[e]=d,this.orders.set(i),d}static \u0275fac=function(t){return new(t||o)};static \u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"})};export{l as a};
